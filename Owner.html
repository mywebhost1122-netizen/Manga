<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Panel</title>
    <style>
        :root {
            --primary-red: #d9262d;
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #aaaaaa;
            --border-color: #333333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--background-color); color: var(--text-primary); }
        .view { display: none; }
        .view.active { display: block; }
        .container { padding: 15px; padding-bottom: 90px; }
        .form-header { display: flex; align-items: center; gap: 15px; background-color: var(--surface-color); padding: 15px; border-bottom: 1px solid var(--border-color); }
        .back-button { background:none; border:none; color:white; cursor: pointer; }
        .back-button svg { width: 28px; height: 28px; fill: currentColor; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .page-header h1 { font-size: 24px; }
        .total-count { font-size: 14px; color: var(--text-secondary); }
        .search-bar { width: 100%; padding: 12px; background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px; margin-bottom: 20px; }
        .list-item { background-color: var(--surface-color); border-radius: 8px; padding: 15px; margin-bottom: 10px; transition: background-color: 0.3s; }
        .item-info { display: flex; justify-content: space-between; align-items: center; }
        .item-actions { display: flex; gap: 15px; }
        .item-actions button { background: none; border: none; cursor: pointer; }
        .item-actions svg { width: 22px; height: 22px; fill: var(--text-secondary); transition: fill 0.2s; }
        .edit-btn:hover svg { fill: #42a5f5; }
        .delete-btn:hover svg { fill: var(--primary-red); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--text-secondary); }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px; }
        .form-button { background-color: var(--primary-red); color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--surface-color); display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid var(--border-color); z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-secondary); text-decoration: none; gap: 4px; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary-red); }
        .nav-item svg { width: 28px; height: 28px; fill: currentColor; }
        .nav-item span { font-size: 12px; }
        .fab { position: fixed; bottom: 80px; right: 20px; background-color: var(--primary-red); width: 60px; height: 60px; border-radius: 50%; border: none; color: white; font-size: 36px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 1001; }
        #options-modal { position: fixed; bottom: 0; left: 0; width: 100%; background-color: #1f1f1f; z-index: 1002; padding: 25px 15px; padding-bottom: 30px; border-top-left-radius: 20px; border-top-right-radius: 20px; transform: translateY(100%); transition: transform 0.3s ease-in-out; box-shadow: 0 -4px 15px rgba(0,0,0,0.4); }
        #options-modal.show { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { font-size: 20px; }
        .close-btn { font-size: 28px; color: white; background: none; border: none; cursor: pointer; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .option-button { background-color: var(--primary-red); color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; font-weight: bold; text-align: center; cursor: pointer; text-decoration: none; display: block; }
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; display: none; }
        .modal-backdrop.show { display: block; }
    </style>
</head>
<body>
    <!-- VIEWS -->
    <main id="view-manga-list" class="view active">
        <div class="container">
            <div class="page-header"><h1>All Manga</h1> <span id="manga-count" class="total-count">Total: 0</span></div>
            <input type="text" class="search-bar" placeholder="Search for manga...">
            <div id="manga-list-container"></div>
        </div>
    </main>
    <main id="view-popular-cards" class="view">
        <div class="container">
            <div class="page-header"><h1>Popular Cards</h1> <span id="popular-count" class="total-count">Total: 0</span></div>
            <input type="text" class="search-bar" placeholder="Search for popular card...">
            <div id="popular-list-container"></div>
        </div>
    </main>
    <!-- FORM VIEWS -->
    <main id="view-add-manga" class="view">
        <header class="form-header">
            <button class="back-button" onclick="showView('view-manga-list')"><svg viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"/></svg></button>
            <h2>Add New Manga</h2>
        </header>
        <div class="container">
            <form id="add-manga-form">
                <div class="form-group"><label>Title</label><input type="text" id="manga-title" required></div>
                <div class="form-group"><label>Image URL</label><input type="url" id="manga-image" required></div>
                <div class="form-group"><label>Description</label><textarea id="manga-desc" rows="4"></textarea></div>
                <div class="form-group"><label>Details (e.g., Vol 23 [EN])</label><input type="text" id="manga-details"></div>
                <div class="form-group"><label>Telegram Channel Link</label><input type="url" id="manga-link" required></div>
                <button type="submit" class="form-button">Save Manga</button>
            </form>
        </div>
    </main>
    <main id="view-add-popular" class="view">
        <header class="form-header">
            <button class="back-button" onclick="showView('view-popular-cards')"><svg viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"/></svg></button>
            <h2>Add Popular Card</h2>
        </header>
         <div class="container">
            <form id="add-popular-form">
                <div class="form-group"><label>Title</label><input type="text" id="popular-title" required></div>
                <div class="form-group"><label>Image URL</label><input type="url" id="popular-image" required></div>
                 <div class="form-group"><label>Description</label><textarea id="popular-desc" rows="4"></textarea></div>
                <div class="form-group"><label>Telegram Channel Link</label><input type="url" id="popular-link" required></div>
                <button type="submit" class="form-button">Save Card</button>
            </form>
        </div>
    </main>
    <!-- GLOBAL UI -->
    <button id="fab" class="fab">+</button>
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div id="options-modal">
        <div class="modal-header"><h2>Options</h2><button class="close-btn" id="close-modal-btn">&times;</button></div>
        <div class="options-grid">
            <button class="option-button" onclick="navigateTo('view-add-manga')">Add Manga</button>
            <button class="option-button" onclick="navigateTo('view-add-popular')">Add Popular Card</button>
        </div>
    </div>
    <nav class="bottom-nav">
        <div id="nav-manga" class="nav-item active" onclick="showView('view-manga-list')">
             <svg viewBox="0 0 24 24"><path d="M5,13.18V17.18L12,21L19,17.18V13.18L12,17L5,13.18M12,3L1,9L12,15L23,9L12,3Z" /></svg>
            <span>Manga</span>
        </div>
        <div id="nav-popular" class="nav-item" onclick="showView('view-popular-cards')">
            <svg viewBox="0 0 24 24"><path d="M17.9,17.39C17.64,16.59 16.89,16 16,16H15V13H16.5C17.33,13 18,12.33 18,11.5C18,10.67 17.33,10 16.5,10H15V8H16C16.89,8 17.64,7.41 17.9,6.61L19,12L17.9,17.39M12,2L14.5,9.5L22,12L14.5,14.5L12,22L9.5,14.5L2,12L9.5,9.5L12,2Z" /></svg>
            <span>Popular</span>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue, push, set, remove, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDw8ZL9MSUueB0IiG4QtluWo2ZfridKca4",
          authDomain: "mystore-c7243.firebaseapp.com",
          projectId: "mystore-c7243",
          databaseURL: "https://mystore-c7243-default-rtdb.firebaseio.com",
          storageBucket: "mystore-c7243.firebasestorage.app",
          messagingSenderId: "322237981437",
          appId: "1:322237981437:web:069d6d2c56767e9d67d494",
          measurementId: "G-R1DWPF85LJ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- GLOBAL ELEMENTS ---
        const allViews = document.querySelectorAll('.view');
        const navItems = document.querySelectorAll('.nav-item');
        const fab = document.getElementById('fab');
        const optionsModal = document.getElementById('options-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const mangaListContainer = document.getElementById('manga-list-container');
        const popularListContainer = document.getElementById('popular-list-container');

        // --- NAVIGATION LOGIC ---
        window.showView = function(viewId) {
            allViews.forEach(view => view.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            navItems.forEach(item => item.classList.remove('active'));
            if (viewId.includes('manga')) document.getElementById('nav-manga').classList.add('active');
            else if (viewId.includes('popular')) document.getElementById('nav-popular').classList.add('active');
            fab.style.display = viewId.startsWith('view-add') ? 'none' : 'flex';
        }
        
        function openOptionsModal() { modalBackdrop.classList.add('show'); optionsModal.classList.add('show'); }
        function closeOptionsModal() { modalBackdrop.classList.remove('show'); optionsModal.classList.remove('show'); }
        window.navigateTo = function(viewId) { closeOptionsModal(); setTimeout(() => { showView(viewId); }, 300); }

        fab.addEventListener('click', openOptionsModal);
        closeModalBtn.addEventListener('click', closeOptionsModal);
        modalBackdrop.addEventListener('click', closeOptionsModal);

        // --- FIREBASE CRUD LOGIC ---
        function renderList(container, data, type) {
            container.innerHTML = '';
            if (!data) {
                container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">No items found.</p>';
                return;
            }
            const items = Object.entries(data).reverse(); 
            document.getElementById(`${type}-count`).textContent = `Total: ${items.length}`;
            items.forEach(([key, value]) => {
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.dataset.id = key; 
                listItem.innerHTML = `
                    <div class="item-info">
                        <span class="item-title">${value.title}</span>
                        <div class="item-actions">
                            <button class="edit-btn" title="Edit"><svg viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></svg></button>
                            <button class="delete-btn" title="Delete"><svg viewBox="0 0 24 24"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" /></svg></button>
                        </div>
                    </div>`;
                container.appendChild(listItem);
            });
        }
        onValue(ref(db, 'manga/'), (snapshot) => renderList(mangaListContainer, snapshot.val(), 'manga'));
        onValue(ref(db, 'popular/'), (snapshot) => renderList(popularListContainer, snapshot.val(), 'popular'));

        document.getElementById('add-manga-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newMangaRef = push(ref(db, 'manga/'));
            set(newMangaRef, {
                title: document.getElementById('manga-title').value,
                imageUrl: document.getElementById('manga-image').value,
                description: document.getElementById('manga-desc').value,
                details: document.getElementById('manga-details').value,
                telegramLink: document.getElementById('manga-link').value,
            });
            e.target.reset();
            alert('Manga Added Successfully!');
            showView('view-manga-list');
        });
        document.getElementById('add-popular-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newPopularRef = push(ref(db, 'popular/'));
            set(newPopularRef, {
                title: document.getElementById('popular-title').value,
                imageUrl: document.getElementById('popular-image').value,
                description: document.getElementById('popular-desc').value,
                telegramLink: document.getElementById('popular-link').value,
            });
            e.target.reset();
            alert('Popular Card Added Successfully!');
            showView('view-popular-cards');
        });

        function handleActions(event) {
            const target = event.target;
            const actionButton = target.closest('.delete-btn, .edit-btn');
            if (!actionButton) return;

            const listItem = actionButton.closest('.list-item');
            const itemId = listItem.dataset.id;
            const itemTitle = listItem.querySelector('.item-title').textContent;
            const type = listItem.closest('#manga-list-container') ? 'manga' : 'popular';
            const itemRef = ref(db, `${type}/${itemId}`);

            if (actionButton.classList.contains('delete-btn')) {
                if (confirm(`Are you sure you want to delete "${itemTitle}"?`)) {
                    remove(itemRef);
                    alert(`"${itemTitle}" deleted.`);
                }
            } else if (actionButton.classList.contains('edit-btn')) {
                const newTitle = prompt("Enter new title for:", itemTitle);
                if (newTitle && newTitle.trim() !== "") {
                    update(itemRef, { title: newTitle.trim() });
                    alert(`Title updated.`);
                }
            }
        }
        mangaListContainer.addEventListener('click', handleActions);
        popularListContainer.addEventListener('click', handleActions);
    </script>
</body>
  </html>
